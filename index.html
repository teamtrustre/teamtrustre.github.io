<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MTDBLT2P');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SUT(SuperTrust)ë¥¼ í¸ë¦¬í•˜ê²Œ ê³„ì‚°í•´ë³´ì„¸ìš”</title>
    
    <meta name="description" content="SUT(ìŠˆí¼íŠ¸ëŸ¬ìŠ¤íŠ¸) ì½”ì¸ì˜ ì‹¤ì‹œê°„ ì‹œì„¸ë¥¼ í™•ì¸í•˜ê³ , í• ì¸ìœ¨ì„ ì ìš©í•˜ì—¬ í¸ë¦¬í•˜ê²Œ ê²°ì œ ê¸ˆì•¡ì„ ê³„ì‚°í•˜ì„¸ìš”.">
    <meta name="keywords" content="SUT, SUTì½”ì¸, ìŠˆí¼íŠ¸ëŸ¬ìŠ¤íŠ¸, SuperTrust, SUT ê³„ì‚°ê¸°, ì½”ì¸ ê³„ì‚°ê¸°, ì‹¤ì‹œê°„ ì‹œì„¸, ìë™ ê³„ì‚°, L2U, ë ˆì €íˆ¬ìœ , trustre, íŠ¸ëŸ¬ìŠ¤íŠ¸ë¦¬">
    <meta name="author" content="trustre">
    <meta property="og:type" content="website">
    <meta property="og:title" content="SUT ì‹¤ì‹œê°„ ì‹œì„¸ í™•ì¸ ë° ê³„ì‚°ê¸°">
    <meta property="og:description" content="SUTì˜ í˜„ì¬ ê°€ê²©ì„ í™•ì¸í•˜ê³  í• ì¸ìœ¨ì„ ì ìš©í•´ ìë™ ê³„ì‚°í•´ë³´ì„¸ìš”.">
    <meta property="og:site_name" content="trustre">
    <meta name="robots" content="index, follow">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "trustre",
      "alternateName": ["ìŠˆí¼íŠ¸ëŸ¬ìŠ¤íŠ¸ ê³„ì‚°ê¸°", "SUT ì½”ì¸ ê³„ì‚°ê¸°"],
      "description": "SUT(SuperTrust) ì½”ì¸ì˜ ì‹¤ì‹œê°„ KRW ê°€ê²©ì„ í™•ì¸í•˜ê³  ê²°ì œ ê¸ˆì•¡ì„ ê³„ì‚°í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "KRW"
      }
    }
    </script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- QR ìŠ¤ìºë„ˆ -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <!-- ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ (jsDelivr) -->
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    
    <style>
        html { background-color: #f2f4f6; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f2f4f6;
            color: #191f28;
            -webkit-tap-highlight-color: transparent;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }
        #app-container {
            width: 100%;
            max-width: 448px;
            height: 100vh;
            max-height: 100vh;
            background-color: white;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        #main-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 40px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #main-content::-webkit-scrollbar { display: none; }
        .num-font { font-variant-numeric: tabular-nums; letter-spacing: -0.5px; }
        .amount-input {
            border: none;
            background: transparent;
            font-size: 2.5rem;
            font-weight: 700;
            color: #333d4b;
            width: 30px;
            min-width: 30px;
            outline: none;
            padding: 0;
            margin: 0;
            caret-color: #9333ea;
            border-radius: 0;
            text-align: left;
        }
        .amount-input::placeholder { color: #b0b8c1; }
        @keyframes flash { 0% { color: #9333ea; } 100% { color: #4e5968; } }
        .price-update { animation: flash 1s ease-out; }
        
        #qr-reader { width: 100%; height: 100%; border: none !important; }
        #qr-reader video { width: 100% !important; height: 100% !important; object-fit: cover !important; border-radius: 0 !important; }
        #qr-reader__scan_region { background: transparent; }
        #qr-reader__dashboard_section_csr button { display: none; }
        
        .scan-frame-container { position: relative; width: 260px; height: 260px; z-index: 20; }
        .scan-mask {
            position: absolute;
            inset: 0;
            border-radius: 24px;
            box-shadow: 0 0 0 200vmax rgba(0, 0, 0, 0.6);
            pointer-events: none;
        }

        .scan-corner { position: absolute; width: 30px; height: 30px; border-color: #a855f7; border-style: solid; border-width: 5px; filter: drop-shadow(0 0 4px rgba(168, 85, 247, 0.5)); z-index: 30; }
        .tl { top: 0; left: 0; border-right: none; border-bottom: none; border-radius: 12px 0 0 0; }
        .tr { top: 0; right: 0; border-left: none; border-bottom: none; border-radius: 0 12px 0 0; }
        .bl { bottom: 0; left: 0; border-right: none; border-top: none; border-radius: 0 0 0 12px; }
        .br { bottom: 0; right: 0; border-left: none; border-top: none; border-radius: 0 0 12px 0; }
        .laser-line { position: absolute; width: 100%; height: 4px; background: linear-gradient(90deg, transparent, #d8b4fe, #a855f7, #d8b4fe, transparent); box-shadow: 0 0 15px rgba(168, 85, 247, 0.8); top: 0; animation: radar 2.5s cubic-bezier(0.4, 0, 0.2, 1) infinite; opacity: 0.8; z-index: 30; }
        @keyframes radar { 0% { top: 10%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 90%; opacity: 0; } }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .glass-badge {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.9), rgba(107, 33, 168, 0.95));
            box-shadow: 0 4px 6px -1px rgba(126, 34, 206, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(4px); border: 1px solid rgba(255, 255, 255, 0.1);
            color: white; font-weight: 800; border-radius: 9999px; padding: 4px 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2); letter-spacing: 0.05em;
        }
        /* Vertical Slider Style */
        .vertical-slider-container {
            position: relative;
            width: 32px;
            height: 100%;
            background: #f3f4f6;
            border-radius: 999px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        input[type=range] {
            -webkit-appearance: none;
            width: 140px;
            height: 32px;
            background: transparent;
            outline: none;
            cursor: pointer;
            transform: rotate(-90deg);
            transform-origin: center;
            background-image: linear-gradient(#9333ea, #9333ea);
            background-size: 20% 100%;
            background-repeat: no-repeat;
            transition: background-size 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 32px; width: 0px; box-shadow: none; border: none;
        }
        .discount-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
            white-space: nowrap;
        }
        .discount-btn.active {
            background-color: #6b21a8;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(107, 33, 168, 0.4);
            border-color: #6b21a8;
            transform: translateY(-1px);
        }
        .discount-btn.inactive {
            background-color: #f3e8ff;
            color: #7e22ce;
            border-color: #d8b4fe;
        }
        .status-indicator.bg-green-500 { background-color: #22c55e; box-shadow: 0 0 8px rgba(34, 197, 94, 0.6); }
        .status-indicator.bg-yellow-400 { background-color: #facc15; }
        .status-indicator.bg-red-500 { background-color: #ef4444; }
        
        .modal-label { font-size: 11px; color: #6b7280; margin-bottom: 2px; }
        .modal-value { font-size: 14px; font-weight: bold; color: #1f2937; word-break: break-all; }
        
        /* Jelly Toggle Styles */
        .toggle-container {
            position: relative;
            background-color: #f3f4f6;
            border-radius: 12px;
            padding: 4px;
            display: flex;
            height: 44px;
            cursor: pointer;
            border: 1px solid #e5e7eb;
        }
        .toggle-slider {
            position: absolute;
            top: 4px;
            left: 4px;
            width: calc(50% - 4px);
            height: calc(100% - 8px);
            background-color: white;
            border-radius: 9px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1;
        }
        .toggle-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            z-index: 2;
            transition: color 0.3s;
            user-select: none;
        }
        .toggle-option.active { color: #111827; }
        .toggle-option.inactive { color: #9ca3af; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
        .animate-bounce-slow { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        
        #scannerOverlay {
            --origin-x: 50%;
            --origin-y: 50%;
            -webkit-clip-path: circle(0px at var(--origin-x) var(--origin-y));
            clip-path: circle(0px at var(--origin-x) var(--origin-y));
            opacity: 0;
            transition: -webkit-clip-path 1s cubic-bezier(0.22, 1, 0.36, 1), clip-path 1s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.6s ease, background-color 0.6s ease;
            pointer-events: none;
            background-color: rgba(147, 51, 234, 0.1);
        }
        #scannerOverlay.show {
            -webkit-clip-path: circle(200vmax at var(--origin-x) var(--origin-y));
            clip-path: circle(200vmax at var(--origin-x) var(--origin-y));
            opacity: 1;
            pointer-events: auto;
            background-color: rgba(147, 51, 234, 0.8);
        }
        #scannerOverlay.hide {
            -webkit-clip-path: circle(0px at var(--origin-x) var(--origin-y));
            clip-path: circle(0px at var(--origin-x) var(--origin-y));
            opacity: 0;
            transition: -webkit-clip-path 0.8s cubic-bezier(0.33, 1, 0.68, 1), clip-path 0.8s cubic-bezier(0.33, 1, 0.68, 1), opacity 0.5s ease, background-color 0.5s ease;
            background-color: rgba(147, 51, 234, 0.1);
        }
        .scan-success { box-shadow: 0 0 20px #a855f7; transition: box-shadow 0.5s; }
        
        @keyframes liquid-swirl { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        .siri-btn-container { width: 56px; height: 56px; border-radius: 9999px; position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(147, 51, 234, 0.4); transform: translateZ(0); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s ease; background-color: #f3f4f6; }
        .siri-btn-bg { position: absolute; top: 50%; left: 50%; width: 180%; height: 180%; background: conic-gradient(from 0deg, #a855f7, #d8b4fe, #9333ea, #c084fc, #a855f7); border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; animation: liquid-swirl 6s linear infinite; opacity: 0.9; }
        .qr-fixed-content { position: relative; z-index: 10; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }
    </style>
</head>
<body class="max-w-md mx-auto bg-white shadow-2xl relative w-full">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MTDBLT2P"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Header -->
    <header class="px-6 pt-8 pb-4 shrink-0 bg-white z-10 w-full">
        <div class="flex justify-between items-center mb-10">
            <div class="flex items-center -ml-6">
                <img src="logo.png" alt="SUT Logo" class="h-16 w-auto object-contain z-10 -ml-2" onerror="this.style.display='none'; document.getElementById('fallback-logo').style.display='flex'">
                <div id="fallback-logo" class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center hidden z-10 -ml-2">
                    <i data-lucide="zap" class="w-8 h-8 text-white fill-white"></i>
                </div>
                <span class="font-bold text-xl text-slate-900 z-0 -ml-4">trustre</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="bg-purple-50 px-3 py-1.5 rounded-full flex items-center gap-1.5">
                    <div id="statusIndicator" class="w-2 h-2 bg-gray-300 rounded-full status-indicator"></div>
                    <span class="text-xs font-bold text-purple-700 num-font flex items-center gap-1" id="topPriceDisplay">1 SUT = ...</span>
                </div>
            </div>
        </div>
        <h1 class="text-2xl font-bold text-[#191f28] leading-tight text-left pl-5">
            ê²°ì œí•  ê¸ˆì•¡ì„<br>ì…ë ¥í•´ ì£¼ì„¸ìš”
        </h1>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1 flex flex-col px-6 overflow-y-auto pb-32 w-full">
        <!-- Input Area -->
        <div class="mt-4 flex items-center justify-between w-full relative pl-5">
            <div class="flex items-center justify-start flex-1 relative -ml-[2px]">
                <input type="tel" id="krwInput" class="amount-input num-font" placeholder="0" pattern="[0-9]*" inputmode="numeric" autocomplete="off">
                <span class="text-2xl font-bold text-[#333d4b] ml-1 pointer-events-none shrink-0">ì›</span>
            </div>
            <button id="qrButton" class="siri-btn-container ml-2 shrink-0" aria-label="QR ìŠ¤ìº”">
                <div class="siri-btn-bg"></div>
                <div class="qr-fixed-content">
                    <div class="relative w-7 h-7 flex items-center justify-center">
                        <span class="font-black text-[10px] leading-none tracking-tighter drop-shadow-md">QR</span>
                        <svg class="absolute inset-0 w-full h-full text-white drop-shadow-sm" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2 2H9V4H4V9H2V2Z" /> <path d="M15 2H22V9H20V4H15V2Z" /> <path d="M2 15H4V20H9V22H2V15Z" /> <path d="M20 15H22V22H15V20H20V15Z" />
                        </svg>
                    </div>
                </div>
            </button>
        </div>
        <div id="krwKorean" class="text-sm text-gray-400 font-medium text-left h-5 mb-2 shrink-0 w-full pl-5"></div>
        
        <!-- Result Card -->
        <div class="bg-[#f2f4f6] rounded-2xl p-5 mt-2 transition-all duration-300 transform scale-95 opacity-50 shrink-0 mb-3" id="resultCard">
            <div class="flex justify-between items-center mb-1">
                <span class="text-sm text-[#4e5968] font-medium">ë³´ë‚´ì•¼ í•  ì½”ì¸</span>
                <button class="text-xs text-[#8b95a1] flex items-center gap-1 bg-white px-2 py-1 rounded shadow-sm border border-gray-100 active:bg-gray-50 hover:bg-gray-50 transition-colors">
                    <i data-lucide="refresh-cw" class="w-3 h-3" id="refreshIcon"></i><span id="refreshText">ì—…ë°ì´íŠ¸</span>
                </button>
            </div>
            <div class="flex items-baseline gap-1 mb-1">
                <span id="sutAmount" class="text-3xl font-bold text-purple-600 num-font">0</span>
                <span class="text-lg font-bold text-purple-600">SUT</span>
                <button class="text-[#8b95a1] hover:text-purple-600 transition-colors p-1 ml-1 translate-y-0.5" aria-label="ë„ì›€ë§ ë³´ê¸°">
                    <i data-lucide="help-circle" class="w-4 h-4"></i>
                </button>
            </div>
            <div id="infoText" class="hidden text-[11px] text-gray-500 mt-2 bg-white p-3 rounded-xl border border-gray-100 shadow-sm leading-relaxed break-keep">
                í¸ì˜ì„±ì„ ìœ„í•´ ì†Œìˆ˜ì ì„ ìƒëµí–ˆì–´ìš”. ìì‚°ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€ ê±°ì˜ ì—†ìœ¼ë‹ˆ ì•ˆì‹¬í•´ë„ ì¢‹ì•„ìš”.
            </div>
            <!-- Discount Slider -->
            <div class="mt-5 mb-5 bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-stretch gap-4 h-[160px]">
                <div class="flex flex-col justify-between flex-1">
                    <div class="flex flex-col items-start">
                        <span class="text-[10px] font-bold text-slate-400 mb-0.5">í˜„ì¬ í• ì¸ìœ¨</span>
                        <div class="flex items-center gap-2">
                            <span id="discountDisplay" class="text-3xl font-black text-purple-600 leading-none">10%</span>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 mt-2">
                        <button id="btn20" class="discount-btn inactive w-full py-2.5 text-xs font-bold rounded-lg shadow-sm">20%</button>
                        <button id="btn10" class="discount-btn active w-full py-2.5 text-xs font-bold rounded-lg shadow-sm">10%</button>
                    </div>
                </div>
                <div class="vertical-slider-container">
                    <input type="range" id="discountSlider" min="0" max="50" step="10" value="10">
                    <div class="absolute bottom-3 w-full text-center text-[10px] font-bold text-gray-400 pointer-events-none">0</div>
                    <div class="absolute top-3 w-full text-center text-[10px] font-bold text-white pointer-events-none mix-blend-overlay">50</div>
                </div>
            </div>
            <!-- Main Actions -->
            <div class="flex gap-3 mt-4">
                <button id="copyBtn" class="flex-1 bg-white text-slate-600 font-bold text-base py-3 rounded-xl active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-2 border border-gray-200 shadow-sm" disabled>ìˆ˜ëŸ‰ ë³µì‚¬</button>
                <button id="walletBtn" class="flex-[1.4] bg-purple-600 text-white font-bold text-base py-3 rounded-xl active:scale-[0.98] transition-all disabled:opacity-50 flex items-center justify-center gap-2 shadow-md hover:bg-purple-700 shadow-purple-200" disabled><i data-lucide="send" class="w-5 h-5"></i> ì†¡ê¸ˆí•˜ê¸°</button>
            </div>
        </div>

        <!-- Links -->
        <div class="grid grid-cols-2 gap-3 mb-2">
            <a href="https://naver.me/FeNWPtbK" target="_blank" class="relative bg-white border border-gray-100 rounded-2xl h-20 shadow-sm hover:border-purple-200 hover:shadow-md active:scale-[0.98] transition-all overflow-hidden group">
                <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-purple-100/60 to-transparent opacity-100 pointer-events-none"></div>
                <div class="absolute top-1/2 -translate-y-1/2 left-4 z-10">
                    <span class="block text-base font-bold text-gray-700 leading-tight group-hover:text-purple-600 transition-colors">SUT<br>ì‚¬ìš©ì²˜ í™•ì¸</span>
                </div>
                <div class="absolute -bottom-3 -right-3 transform rotate-[-15deg] group-hover:scale-110 group-hover:rotate-[-5deg] group-hover:-translate-y-1 transition-all duration-500 ease-out z-10">
                    <!-- Pin SVG -->
                    <svg width="70" height="70" viewBox="0 0 100 100" fill="none"><ellipse cx="50" cy="90" rx="20" ry="6" fill="#000" fill-opacity="0.1" filter="url(#blur)"/><path d="M50 88C50 88 78 58 78 40C78 24.536 65.464 12 50 12C34.536 12 22 24.536 22 40C22 58 50 88 50 88Z" fill="url(#softPinGradient)"/><ellipse cx="38" cy="32" rx="8" ry="12" fill="white" fill-opacity="0.25" transform="rotate(-30 38 32)"/><circle cx="50" cy="40" r="14" fill="#F3E8FF"/><circle cx="50" cy="40" r="14" fill="url(#innerShadow)" fill-opacity="0.5"/><defs><filter id="blur" x="20" y="80" width="60" height="20" filterUnits="userSpaceOnUse"><feGaussianBlur stdDeviation="3"/></filter><radialGradient id="softPinGradient" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(40 30) rotate(55) scale(65)"><stop stop-color="#E9D5FF"/><stop offset="0.6" stop-color="#C084FC"/><stop offset="1" stop-color="#9333EA"/></radialGradient><radialGradient id="innerShadow" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(50 40) scale(14)"><stop offset="0.7" stop-color="#A855F7" stop-opacity="0"/><stop offset="1" stop-color="#7E22CE" stop-opacity="0.3"/></radialGradient></defs></svg>
                </div>
            </a>
            <a href="https://www.instagram.com/trust_retail/" target="_blank" class="relative bg-white border border-gray-100 rounded-2xl h-20 shadow-sm hover:border-pink-200 hover:shadow-md active:scale-[0.98] transition-all overflow-hidden group">
                <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-pink-100/60 to-transparent opacity-100 pointer-events-none"></div>
                <div class="absolute top-1/2 -translate-y-1/2 left-4 z-10">
                    <span class="block text-base font-bold text-gray-700 group-hover:text-pink-500 transition-colors">ì¸ìŠ¤íƒ€ê·¸ë¨</span>
                </div>
                <div class="absolute -bottom-2 -right-2 transform rotate-[15deg] group-hover:scale-110 group-hover:rotate-[5deg] group-hover:-translate-y-1 transition-all duration-500 ease-out z-10">
                    <!-- Insta SVG -->
                    <svg width="65" height="65" viewBox="0 0 100 100" fill="none"><rect x="15" y="85" width="70" height="10" rx="5" fill="#000" fill-opacity="0.1" filter="url(#blurInsta)"/><rect x="10" y="14" width="80" height="80" rx="22" fill="#Eecbeb"/><rect x="10" y="10" width="80" height="80" rx="22" fill="url(#softInstaGradient)"/><rect x="11.5" y="11.5" width="77" height="77" rx="20.5" stroke="white" stroke-opacity="0.4" stroke-width="3"/><rect x="25" y="25" width="50" height="50" rx="15" stroke="white" stroke-width="6" stroke-opacity="0.9"/><circle cx="50" cy="50" r="14" stroke="white" stroke-width="6" stroke-opacity="0.9"/><circle cx="74" cy="26" r="4.5" fill="white" fill-opacity="0.9"/><path d="M10 30Q30 10 50 10L90 10L90 50Q70 30 10 30Z" fill="white" fill-opacity="0.1" style="mix-blend-mode: overlay;"/><defs><filter id="blurInsta" x="5" y="75" width="90" height="30" filterUnits="userSpaceOnUse"><feGaussianBlur stdDeviation="4"/></filter><linearGradient id="softInstaGradient" x1="10" y1="90" x2="90" y2="10" gradientUnits="userSpaceOnUse"><stop stop-color="#FCD34D"/><stop offset="0.5" stop-color="#F472B6"/><stop offset="1" stop-color="#C084FC"/></linearGradient></defs></svg>
                </div>
            </a>
        </div>

        <!-- Menu Section -->
        <div class="border-t border-gray-100 pt-4 pb-4">
            <div class="flex flex-col gap-2 mb-6">
                <!-- Chart Toggle -->
                <button group="chart" class="w-full bg-white border border-gray-100 rounded-2xl py-3 px-4 shadow-sm flex items-center justify-between active:scale-[0.99] transition-all hover:border-purple-200 group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 flex items-center justify-center filter drop-shadow-sm group-hover:scale-110 transition-transform duration-300">
                            <svg viewBox="0 0 36 36" fill="none" class="w-full h-full"><path d="M4 28V16C4 14.8954 4.89543 14 6 14H10C11.1046 14 12 14.8954 12 16V28C12 29.1046 11.1046 30 10 30H6C4.89543 30 4 29.1046 4 28Z" fill="url(#bar1)"/><path d="M14 28V10C14 8.89543 14.8954 8 16 8H20C21.1046 8 22 8.89543 22 10V28C22 29.1046 21.1046 30 20 30H16C14.8954 30 14 29.1046 14 28Z" fill="url(#bar2)"/><path d="M24 28V4C24 2.89543 24.8954 2 26 2H30C31.1046 2 32 2.89543 32 4V28C32 29.1046 31.1046 30 30 30H26C24.8954 30 24 29.1046 24 28Z" fill="url(#bar3)"/><defs><linearGradient id="bar1" x1="8" y1="14" x2="8" y2="30" gradientUnits="userSpaceOnUse"><stop stop-color="#E9D5FF"/><stop offset="1" stop-color="#C084FC"/></linearGradient><linearGradient id="bar2" x1="18" y1="8" x2="18" y2="30" gradientUnits="userSpaceOnUse"><stop stop-color="#D8B4FE"/><stop offset="1" stop-color="#A855F7"/></linearGradient><linearGradient id="bar3" x1="28" y1="2" x2="28" y2="30" gradientUnits="userSpaceOnUse"><stop stop-color="#C084FC"/><stop offset="1" stop-color="#7E22CE"/></linearGradient></defs></svg>
                        </div>
                        <span class="text-base font-bold text-gray-700">SUT ì°¨íŠ¸ ë³´ê¸°</span>
                    </div>
                    <i data-lucide="chevron-down" id="chartToggleIcon" class="w-5 h-5 text-gray-400 transition-transform duration-300"></i>
                </button>
                <div id="chartContent" class="hidden overflow-hidden transition-all duration-300 ease-in-out">
                    <div class="bg-gray-50 rounded-2xl p-4 border border-gray-100 mt-2">
                        <div class="mb-2 px-1 flex justify-between items-end">
                            <div><h3 class="font-bold text-slate-800 text-lg mb-1">SUT/KRW</h3><p class="text-xs text-gray-400">ìµœê·¼ 24ì‹œê°„ íë¦„</p></div>
                            <div id="lastUpdatedTime" class="text-[10px] text-gray-400 bg-white px-2 py-1 rounded-md border border-gray-200">ì—…ë°ì´íŠ¸ ì¤‘...</div>
                        </div>
                        <div class="w-full h-56 bg-white rounded-xl overflow-hidden relative border border-gray-200 shadow-inner">
                            <div id="tvChartContainer" class="w-full h-full"></div>
                            <div id="chartLoader" class="absolute inset-0 flex items-center justify-center bg-white z-10"><div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div></div>
                            <div id="chartError" class="absolute inset-0 flex items-center justify-center bg-gray-50 text-gray-400 text-xs hidden">ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ìš”</div>
                        </div>
                    </div>
                </div>
                
                <!-- Fortune Button -->
                <button group="fortune" class="w-full bg-white border border-gray-100 rounded-2xl py-3 px-4 shadow-sm flex items-center justify-between active:scale-[0.99] transition-all hover:border-yellow-200 group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 flex items-center justify-center filter drop-shadow-sm group-hover:scale-110 transition-transform duration-300">
                            <!-- Clover SVG -->
                            <svg viewBox="0 0 36 36" fill="none" class="w-full h-full"><path d="M18 18C18 18 14 10 10 10C6 10 4 14 4 18C4 22 10 22 18 18Z" fill="url(#leaf1)"/><path d="M18 18C18 18 26 10 30 10C34 10 36 14 36 18C36 22 30 22 18 18Z" fill="url(#leaf2)"/><path d="M18 18C18 18 10 26 10 30C10 34 14 36 18 36C22 36 22 30 18 18Z" fill="url(#leaf3)"/><path d="M18 18C18 18 26 26 30 30C34 30 36 26 36 22C36 18 30 18 18 18Z" fill="url(#leaf4)"/><path d="M18 18C18 18 10 10 6 6C2 2 2 8 18 18Z" fill="url(#leaf1)" fill-opacity="0.5"/><circle cx="18" cy="18" r="2" fill="#FEF08A"/><defs><linearGradient id="leaf1" x1="18" y1="18" x2="4" y2="10" gradientUnits="userSpaceOnUse"><stop stop-color="#4ADE80"/><stop offset="1" stop-color="#22C55E"/></linearGradient><linearGradient id="leaf2" x1="18" y1="18" x2="36" y2="10" gradientUnits="userSpaceOnUse"><stop stop-color="#86EFAC"/><stop offset="1" stop-color="#4ADE80"/></linearGradient><linearGradient id="leaf3" x1="18" y1="18" x2="10" y2="36" gradientUnits="userSpaceOnUse"><stop stop-color="#BBF7D0"/><stop offset="1" stop-color="#86EFAC"/></linearGradient><linearGradient id="leaf4" x1="18" y1="18" x2="36" y2="26" gradientUnits="userSpaceOnUse"><stop stop-color="#4ADE80"/><stop offset="1" stop-color="#16A34A"/></linearGradient></defs></svg>
                        </div>
                        <span class="text-base font-bold text-gray-700">ì˜¤ëŠ˜ì˜ ìš´ì„¸</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- Fortune Modal (Enhanced) -->
    <div id="fortuneModal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl w-full max-w-sm text-center shadow-2xl transform transition-all scale-100 relative overflow-hidden flex flex-col max-h-[85vh]">
            <!-- Modal Header -->
            <div class="pt-8 px-6 pb-2 shrink-0">
                <h3 class="text-xl font-bold text-gray-900">ì˜¤ëŠ˜ì˜ ìš´ì„¸</h3>
                <p class="text-xs text-gray-400 mt-1">ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ë” ì •í™•í•œ ìš´ì„¸ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”</p>
            </div>

            <!-- Modal Body -->
            <div class="px-6 py-2 overflow-y-auto flex-1 custom-scrollbar">
                <!-- Input Step -->
                <div id="fortuneInputStep" class="space-y-4 text-left">
                    <!-- ìƒë…„ì›”ì¼ -->
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1.5 ml-1">ìƒë…„ì›”ì¼</label>
                        <div class="grid grid-cols-3 gap-2">
                            <select id="selYear" class="bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 text-sm font-medium text-gray-700 outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-100 transition-all text-center"></select>
                            <select id="selMonth" class="bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 text-sm font-medium text-gray-700 outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-100 transition-all text-center"></select>
                            <select id="selDay" class="bg-gray-50 border border-gray-200 rounded-xl px-2 py-3 text-sm font-medium text-gray-700 outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-100 transition-all text-center"></select>
                        </div>
                    </div>

                    <!-- Jelly Toggles -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1.5 ml-1">ì–‘ë ¥/ìŒë ¥</label>
                            <div class="toggle-container" onclick="toggleCalendar()">
                                <div id="calSlider" class="toggle-slider"></div>
                                <div class="toggle-option active" id="optSolar">ì–‘ë ¥</div>
                                <div class="toggle-option inactive" id="optLunar">ìŒë ¥</div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1.5 ml-1">ì„±ë³„</label>
                            <div class="toggle-container" onclick="toggleGender()">
                                <div id="genSlider" class="toggle-slider"></div>
                                <div class="toggle-option active" id="optMale">ë‚¨ì„±</div>
                                <div class="toggle-option inactive" id="optFemale">ì—¬ì„±</div>
                            </div>
                        </div>
                    </div>

                    <!-- íƒœì–´ë‚œ ì‹œê°„ -->
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1.5 ml-1">íƒœì–´ë‚œ ì‹œê°„ <span class="text-gray-300 font-normal">(ì„ íƒ)</span></label>
                        <select id="birthTime" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-medium text-gray-700 outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-100 transition-all appearance-none">
                            <option value="">ì‹œê°„ ëª¨ë¦„</option>
                            <option value="0">ìì‹œ (23:30 ~ 01:29)</option>
                            <option value="1">ì¶•ì‹œ (01:30 ~ 03:29)</option>
                            <option value="2">ì¸ì‹œ (03:30 ~ 05:29)</option>
                            <option value="3">ë¬˜ì‹œ (05:30 ~ 07:29)</option>
                            <option value="4">ì§„ì‹œ (07:30 ~ 09:29)</option>
                            <option value="5">ì‚¬ì‹œ (09:30 ~ 11:29)</option>
                            <option value="6">ì˜¤ì‹œ (11:30 ~ 13:29)</option>
                            <option value="7">ë¯¸ì‹œ (13:30 ~ 15:29)</option>
                            <option value="8">ì‹ ì‹œ (15:30 ~ 17:29)</option>
                            <option value="9">ìœ ì‹œ (17:30 ~ 19:29)</option>
                            <option value="10">ìˆ ì‹œ (19:30 ~ 21:29)</option>
                            <option value="11">í•´ì‹œ (21:30 ~ 23:29)</option>
                        </select>
                    </div>
                </div>

                <!-- Result Step (Toss UI Style) -->
                <div id="fortuneResultStep" class="hidden text-left animate-fadeIn pb-4">
                    <!-- Dynamic Theme Background -->
                    <div id="fortuneThemeBg" class="p-6 rounded-[24px] shadow-sm relative overflow-hidden transition-colors duration-500 mb-6 text-center">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-20 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div>
                        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full blur-2xl -ml-10 -mb-10 pointer-events-none"></div>
                        <div class="text-6xl mb-3 animate-bounce-slow"><span id="fortuneMainEmoji">ğŸ€</span></div>
                        <h4 class="text-xl font-extrabold text-gray-800 mb-2 leading-tight tracking-tight" id="fortuneMainTitle">...</h4>
                        <p class="text-sm font-medium text-gray-600 leading-relaxed break-keep opacity-80" id="fortuneMainDesc">...</p>
                    </div>

                    <!-- Details Grid -->
                    <div class="space-y-4 px-1">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 text-xl shadow-sm">â¤ï¸</div>
                            <div class="flex-1 pt-0.5">
                                <div class="flex justify-between items-center mb-1.5"><span class="text-base font-bold text-gray-800">ì• ì •ìš´</span><span class="text-sm font-bold" id="scoreLove">--</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden mb-1.5"><div id="barLove" class="h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
                                <p class="text-xs text-gray-500 font-medium leading-normal break-keep" id="descLove">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 text-xl shadow-sm">ğŸ’°</div>
                            <div class="flex-1 pt-0.5">
                                <div class="flex justify-between items-center mb-1.5"><span class="text-base font-bold text-gray-800">ê¸ˆì „ìš´</span><span class="text-sm font-bold" id="scoreMoney">--</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden mb-1.5"><div id="barMoney" class="h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
                                <p class="text-xs text-gray-500 font-medium leading-normal break-keep" id="descMoney">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 text-xl shadow-sm">ğŸ’¼</div>
                            <div class="flex-1 pt-0.5">
                                <div class="flex justify-between items-center mb-1.5"><span class="text-base font-bold text-gray-800">ì§ì¥/ì‚¬ì—…</span><span class="text-sm font-bold" id="scoreWork">--</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden mb-1.5"><div id="barWork" class="h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
                                <p class="text-xs text-gray-500 font-medium leading-normal break-keep" id="descWork">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 text-xl shadow-sm">ğŸ“</div>
                            <div class="flex-1 pt-0.5">
                                <div class="flex justify-between items-center mb-1.5"><span class="text-base font-bold text-gray-800">í•™ì—…/ì„±ì </span><span class="text-sm font-bold" id="scoreStudy">--</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden mb-1.5"><div id="barStudy" class="h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
                                <p class="text-xs text-gray-500 font-medium leading-normal break-keep" id="descStudy">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center shrink-0 text-xl shadow-sm">ğŸ’ª</div>
                            <div class="flex-1 pt-0.5">
                                <div class="flex justify-between items-center mb-1.5"><span class="text-base font-bold text-gray-800">ê±´ê°•ìš´</span><span class="text-sm font-bold" id="scoreHealth">--</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden mb-1.5"><div id="barHealth" class="h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%"></div></div>
                                <p class="text-xs text-gray-500 font-medium leading-normal break-keep" id="descHealth">...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 pt-3 shrink-0">
                <button id="btnCheckFortune" class="w-full bg-gray-900 hover:bg-gray-800 text-white font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2">
                    <span>ìš´ì„¸ í™•ì¸í•˜ê¸°</span>
                    <i data-lucide="sparkles" class="w-4 h-4 text-yellow-300"></i>
                </button>
                <button id="btnResetFortune" class="w-full bg-white border border-gray-200 text-gray-600 font-bold py-3.5 rounded-xl mt-2 active:scale-95 transition-all hidden">
                    ë‹¤ë¥¸ ì •ë³´ë¡œ ë‹¤ì‹œ ë³´ê¸°
                </button>
                <button class="w-full text-gray-400 text-xs font-medium py-3 mt-1" onclick="closeFortuneModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ... (Other Modals) ... -->
    <div id="scannerOverlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black"><div id="qr-reader" class="absolute inset-0 w-full h-full z-0"></div><div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-10"><div class="scan-frame-container" id="scanFrame"><div class="scan-mask"></div> <div class="laser-line"></div> <div class="scan-corner tl"></div><div class="scan-corner tr"></div><div class="scan-corner bl"></div><div class="scan-corner br"></div></div><p class="text-white/90 text-sm mt-8 font-medium animate-pulse text-center drop-shadow-md z-20">QRì½”ë“œë¥¼ ì‚¬ê°í˜• ì•ˆì— ë¹„ì¶°ì£¼ì„¸ìš”</p></div><button class="absolute bottom-12 px-6 py-3 bg-white/20 text-white rounded-full text-sm font-bold backdrop-blur-md border border-white/10 hover:bg-white/30 transition-all pointer-events-auto z-20 shadow-lg">ë‹«ê¸°</button></div>
    <div id="scanResultModal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl transform transition-all scale-100"><div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="check" class="w-6 h-6 text-green-600"></i></div><h3 class="text-xl font-bold text-gray-900 mb-2">ìŠ¤ìº” ì„±ê³µ!</h3><div class="text-left bg-gray-50 p-4 rounded-xl border border-gray-100 mb-4"><div class="mb-2"><p class="modal-label">ì§€ê°‘ ì£¼ì†Œ</p><p class="modal-value text-xs break-all text-gray-500" id="scanModalAddress">...</p></div><div id="scanAmountDetails" class="grid grid-cols-2 gap-2 mt-2 border-t border-gray-200 pt-2 hidden"><div><p class="modal-label">ë³´ë‚¼ ìˆ˜ëŸ‰</p><p class="modal-value text-purple-600" id="scanModalSut">0 SUT</p></div><div><p class="modal-label">í™˜ì‚° ê¸ˆì•¡</p><p class="modal-value text-gray-800" id="scanModalKrw">0ì›</p></div></div></div><div class="space-y-2"><button class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">ì£¼ì†Œ ë³µì‚¬í•˜ê³  ì§€ê°‘ ì—´ê¸°</button><button class="w-full text-gray-400 text-sm py-2">ë‹«ê¸°</button></div></div></div>
    <div id="sendModal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl transform transition-all scale-100"><div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="send" class="w-6 h-6 text-blue-600"></i></div><h3 class="text-xl font-bold text-gray-900 mb-2">ì†¡ê¸ˆ ì¤€ë¹„</h3><p class="text-sm text-gray-500 mb-4">ê°¯ìˆ˜ë¥¼ ë³µì‚¬í–ˆì–´ìš”. ì•±ì„ ì¼¤ê²Œìš”.</p><div class="text-left bg-gray-50 p-4 rounded-xl border border-gray-100 mb-4"><div class="grid grid-cols-2 gap-2"><div><p class="modal-label">ë³´ë‚¼ ìˆ˜ëŸ‰</p><p class="modal-value text-purple-600" id="sendModalSut">0 SUT</p></div><div><p class="modal-label">í™˜ì‚° ê¸ˆì•¡</p><p class="modal-value text-gray-800" id="sendModalKrw">0ì›</p></div></div></div><button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">ì§€ê¸ˆ ì§€ê°‘ ì—´ê¸°</button><button class="w-full text-gray-400 text-sm py-2 mt-1">ë‹«ê¸°</button></div></div>
    <div id="manualOpenModal" class="fixed inset-0 bg-black/60 z-[80] hidden flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl transform transition-all scale-100"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="alert-circle" class="w-6 h-6 text-red-600"></i></div><h3 class="text-lg font-bold text-gray-900 mb-2">ì•± ì‹¤í–‰ ì˜¤ë¥˜</h3><p class="text-sm text-gray-500 mb-4 leading-relaxed text-left break-keep">ìë™ìœ¼ë¡œ ì•±ì„ ì—´ ìˆ˜ ì—†ì–´ìš”.<br><span class="font-bold text-purple-600">ì§€ê°‘ ì£¼ì†ŒëŠ” ë³µì‚¬ë˜ì—ˆìœ¼ë‹ˆ</span><br>ì•±ì„ ì§ì ‘ ì‹¤í–‰í•´ì£¼ì„¸ìš”.</p><button class="w-full bg-gray-900 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">í™•ì¸</button></div></div>
    <div id="storeRedirectModal" class="fixed inset-0 bg-black/60 z-[80] hidden flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl transform transition-all scale-100"><div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="download" class="w-6 h-6 text-purple-600"></i></div><h3 class="text-lg font-bold text-gray-900 mb-2">ìŠ¤í† ì–´ë¡œ ì´ë™í• ê¹Œìš”?</h3><p class="text-sm text-gray-500 mb-4 leading-relaxed text-left break-keep">ì˜¤ë¥˜ë¡œ ì•±ì„ ì‹¤í–‰í•˜ì§€ ëª»í•´<br>ìŠ¤í† ì–´ë¡œ ì´ë™í• ê²Œìš”.<br><span class="text-xs text-purple-500 mt-1 block">* ê²°ì œ ìˆ˜ëŸ‰(SUT)ì€ ë³µì‚¬ë˜ì—ˆì–´ìš”.</span></p><button class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-all">ìŠ¤í† ì–´ë¡œ ì´ë™</button><button class="w-full text-gray-400 text-sm mt-2">ë‹«ê¸°</button></div></div>
    <div id="previousRecordModal" class="fixed inset-0 bg-black/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl p-6 w-full max-w-xs text-center shadow-2xl transform transition-all scale-100"><div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="history" class="w-6 h-6 text-purple-600"></i></div><h3 class="text-xl font-bold text-gray-900 mb-2">ì´ì „ ê¸°ë¡ ìƒì„¸</h3><div class="text-left bg-gray-50 p-4 rounded-xl border border-gray-100 mb-4"><div class="mb-2"><p class="modal-label">í™˜ì‚° ê¸ˆì•¡</p><p class="modal-value text-gray-800" id="prevModalKrw">0ì›</p></div><div id="prevAddressDetails" class="mb-2 hidden"><p class="modal-label">ì§€ê°‘ ì£¼ì†Œ</p><p class="modal-value text-xs break-all text-gray-500" id="prevModalAddress">...</p><button class="w-full bg-gray-500 text-white font-bold py-2 rounded-xl mt-2 active:scale-95 transition-all">ì£¼ì†Œ ë³µì‚¬</button></div></div><button class="w-full text-gray-400 text-sm py-2">ë‹«ê¸°</button></div></div>
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-[rgba(51,61,75,0.9)] text-white px-5 py-3 rounded-full text-sm font-medium opacity-0 transition-opacity duration-300 pointer-events-none z-[90]">ë³µì‚¬ë˜ì—ˆì–´ìš”</div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Global Vars
        let currentSutPrice = 0; let inputAmount = ''; let discountRate = 10;
        let html5QrCode; let scannedAddress = ''; let isProcessingScan = false;
        let chartInstance = null; let pastSeries = null; let todaySeries = null;
        let selectedCalendar = 'solar'; let selectedGender = 'male';
        let ui = {};

        // [Fixed] FortuneEngine - Completed with biorhythm math, relations, text gen
        const FortuneEngine = {
            // Elements
            elements: {
                wood: { name: 'ëª©(æœ¨)' }, fire: { name: 'í™”(ç«)' }, earth: { name: 'í† (åœŸ)' }, metal: { name: 'ê¸ˆ(é‡‘)' }, water: { name: 'ìˆ˜(æ°´)' }
            },
            // Zodiac to element
            zodiacMap: {
                0: 'metal', 1: 'metal', 2: 'water', 3: 'water', 4: 'wood', 5: 'wood', 6: 'fire', 7: 'fire', 8: 'earth', 9: 'earth', 10: 'metal', 11: 'water'
            },
            // Text templates
            texts: {
                love: {
                    high: ["ë¡œë§¨í‹±í•œ ë§Œë‚¨ì´ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆì–´ìš”. ì ê·¹ì ìœ¼ë¡œ í‘œí˜„í•˜ì„¸ìš”.", "íŒŒíŠ¸ë„ˆì™€ì˜ ê´€ê³„ê°€ ê¹Šì–´ì§€ëŠ” ë‚ ì…ë‹ˆë‹¤."],
                    mid: ["ì•ˆì •ì ì¸ ì• ì •ìš´ì…ë‹ˆë‹¤. ì‘ì€ ì„ ë¬¼ì´ ë¶„ìœ„ê¸°ë¥¼ ì¢‹ê²Œ í•©ë‹ˆë‹¤.", "ì‹±ê¸€ì´ë¼ë©´ ì§€ì¸ ì†Œê°œë¥¼ ê¸°ëŒ€í•´ë³´ì„¸ìš”."],
                    low: ["ê°ì • ì»¨íŠ¸ë¡¤ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì‘ì€ ì˜¤í•´ê°€ ìƒê¸¸ ìˆ˜ ìˆì–´ìš”.", "í˜¼ìë§Œì˜ ì‹œê°„ì„ ê°€ì ¸ë³´ì„¸ìš”."],
                    destructive: "ê´€ê³„ì—ì„œ ë§ˆì°°ì´ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë‹ˆ ìì¡´ì‹¬ ëŒ€ê²°ì€ í”¼í•˜ì„¸ìš”."
                },
                money: {
                    high: ["ëœ»ë°–ì˜ ì´ìµì´ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë³´ì— ê·€ ê¸°ìš¸ì´ì„¸ìš”.", "ê¸ˆì „ì ì¸ íë¦„ì´ ì›í™œí•©ë‹ˆë‹¤. ì‘ì€ íˆ¬ìë„ ê³ ë ¤í•´ë³¼ ë§Œí•©ë‹ˆë‹¤."],
                    mid: ["ìˆ˜ì…ê³¼ ì§€ì¶œì´ ê· í˜•ì„ ì´ë£¹ë‹ˆë‹¤. ê³„íšì ì¸ ì†Œë¹„ê°€ ì¢‹ìŠµë‹ˆë‹¤.", "í° ë³€ë™ì€ ì—†ì§€ë§Œ ì•ˆì •ì ì¸ í•˜ë£¨ì…ë‹ˆë‹¤."],
                    low: ["ì¶©ë™êµ¬ë§¤ë¥¼ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤. ì§€ê°‘ì„ ë‹«ëŠ” ê²ƒì´ í˜„ëª…í•©ë‹ˆë‹¤.", "ì˜ˆìƒì¹˜ ëª»í•œ ì§€ì¶œì´ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë‹ˆ ë¹„ìƒê¸ˆì„ ì•„ë¼ì„¸ìš”."],
                    destructive: "ê¸ˆì „ ê±°ë˜ë‚˜ ê³„ì•½ì€ ë‹¤ìŒìœ¼ë¡œ ë¯¸ë£¨ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤."
                },
                work: {
                    high: ["ë¨¸ë¦¬ íšŒì „ì´ ë¹ ë¥´ê³  ì•„ì´ë””ì–´ê°€ ìƒ˜ì†ŸëŠ” ë‚ ì…ë‹ˆë‹¤.", "ì—…ë¬´ íš¨ìœ¨ì´ ìµœê³ ì¡°ì…ë‹ˆë‹¤. ë¯¸ë¤„ë‘” ì¼ì„ ì²˜ë¦¬í•˜ì„¸ìš”."],
                    mid: ["ê¾¸ì¤€í•¨ì´ ë‹µì…ë‹ˆë‹¤. í‰ì†ŒëŒ€ë¡œ ì„í•˜ë©´ ì„±ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.", "ë™ë£Œì™€ì˜ í˜‘ë ¥ì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤."],
                    low: ["ì§‘ì¤‘ë ¥ì´ ë‹¤ì†Œ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¤‘ìš”í•œ ê²°ì •ì€ ì‹ ì¤‘íˆ.", "ì‹¤ìˆ˜ê°€ ì¦ì„ ìˆ˜ ìˆìœ¼ë‹ˆ ë‘ ë²ˆ ì²´í¬í•˜ëŠ” ìŠµê´€ì„ ê°€ì§€ì„¸ìš”."],
                    generative: "ê·€ì¸ì˜ ë„ì›€ìœ¼ë¡œ ì–´ë ¤ìš´ ë¬¸ì œê°€ í•´ê²°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                },
                health: {
                    high: ["ì—ë„ˆì§€ê°€ ë„˜ì¹©ë‹ˆë‹¤. ìš´ë™ì´ë‚˜ í™œë™ì ì¸ ì·¨ë¯¸ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.", "ì»¨ë””ì…˜ì´ ìµœìƒì…ë‹ˆë‹¤. ë¬´ì—‡ì´ë“  í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤."],
                    mid: ["ì ë‹¹í•œ í™œë™ì´ í™œë ¥ì„ ì¤ë‹ˆë‹¤. ê°€ë²¼ìš´ ì‚°ì±…ì„ ì¶”ì²œí•©ë‹ˆë‹¤.", "í‰ë²”í•œ ì»¨ë””ì…˜ì…ë‹ˆë‹¤. ê·œì¹™ì ì¸ ì‹ì‚¬ë¥¼ ì±™ê¸°ì„¸ìš”."],
                    low: ["í”¼ë¡œê°€ ì‰½ê²Œ ìŒ“ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶©ë¶„í•œ íœ´ì‹ì´ í•„ìš”í•©ë‹ˆë‹¤.", "ë©´ì—­ë ¥ì´ ì•½í•´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ë”°ëœ»í•œ ë¬¼ì„ ìì£¼ ë“œì„¸ìš”."]
                }
            },
            // Calculation - Biorhythm + Element
            calculate: function(birthDate, today) {
                const daysAlive = Math.floor((today - birthDate) / (1000 * 60 * 60 * 24));
                const bio = {
                    physical: Math.sin(2 * Math.PI * daysAlive / 23) * 50 + 50, // 23-day cycle
                    emotional: Math.sin(2 * Math.PI * daysAlive / 28) * 50 + 50, // 28-day
                    intellectual: Math.sin(2 * Math.PI * daysAlive / 33) * 50 + 50 // 33-day
                };
                // Zodiac element
                const birthYear = birthDate.getFullYear();
                const zodiacIndex = birthYear % 12;
                const myElement = this.zodiacMap[zodiacIndex];
                // Day element (simplified)
                const dayStem = daysAlive % 10;
                const dayElement = ['wood', 'wood', 'fire', 'fire', 'earth', 'earth', 'metal', 'metal', 'water', 'water'][dayStem];
                // Relation
                const order = ['wood', 'fire', 'earth', 'metal', 'water'];
                const myIdx = order.indexOf(myElement);
                const dayIdx = order.indexOf(dayElement);
                let relation;
                if (myIdx === dayIdx) relation = 'same';
                else if ((myIdx + 1) % 5 === dayIdx) relation = 'generative';
                else if ((myIdx + 2) % 5 === dayIdx) relation = 'destructive';
                else relation = 'exhausting';
                // Scores (0-10)
                return {
                    love: Math.round(bio.emotional / 10),
                    money: Math.round((bio.physical + bio.emotional) / 20),
                    work: Math.round(bio.intellectual / 10),
                    study: Math.round(bio.intellectual / 10), // Same as work for simplicity
                    health: Math.round(bio.physical / 10),
                    relation: relation,
                    dayElement: this.elements[dayElement].name
                };
            },
            // Get text
            getText: function(type, score, relation, dayOfWeek) {
                const level = score >= 9 ? 'high' : score >= 7 ? 'mid' : 'low';
                const texts = this.texts[type][level];
                let text = texts[Math.floor(Math.random() * texts.length)];
                if (this.texts[type][relation]) text += " " + this.texts[type][relation];
                if (dayOfWeek === 0) text += " ì£¼ë§ì´ë‹ˆ ì—¬ìœ ë¡­ê²Œ ì¦ê¸°ì„¸ìš”.";
                return text;
            }
        };

        // Init UI
        function initUI() {
            ui = {
                krwInput: document.getElementById('krwInput'),
                krwKorean: document.getElementById('krwKorean'),
                sutAmountDisplay: document.getElementById('sutAmount'),
                priceDisplay: document.getElementById('topPriceDisplay'),
                resultCard: document.getElementById('resultCard'),
                copyBtn: document.getElementById('copyBtn'),
                walletBtn: document.getElementById('walletBtn'),
                statusIndicator: document.getElementById('statusIndicator'),
                refreshIcon: document.getElementById('refreshIcon'),
                refreshText: document.getElementById('refreshText'),
                chartLoader: document.getElementById('chartLoader'),
                chartError: document.getElementById('chartError'),
                lastUpdatedTime: document.getElementById('lastUpdatedTime'),
                discountDisplay: document.getElementById('discountDisplay'),
                discountSlider: document.getElementById('discountSlider'),
                btn10: document.getElementById('btn10'),
                btn20: document.getElementById('btn20'),
                selYear: document.getElementById('selYear'),
                selMonth: document.getElementById('selMonth'),
                selDay: document.getElementById('selDay'),
                birthTime: document.getElementById('birthTime'),
                calSlider: document.getElementById('calSlider'),
                genSlider: document.getElementById('genSlider'),
                fortuneInputStep: document.getElementById('fortuneInputStep'),
                fortuneResultStep: document.getElementById('fortuneResultStep'),
                btnCheckFortune: document.getElementById('btnCheckFortune'),
                btnResetFortune: document.getElementById('btnResetFortune'),
                scanModalAddress: document.getElementById('scanModalAddress'),
                scanModalSut: document.getElementById('scanModalSut'),
                scanModalKrw: document.getElementById('scanModalKrw'),
                scanAmountDetails: document.getElementById('scanAmountDetails'),
                sendModalSut: document.getElementById('sendModalSut'),
                sendModalKrw: document.getElementById('sendModalKrw'),
                scanFrame: document.getElementById('scanFrame'),
                // Toggles Options
                optSolar: document.getElementById('optSolar'),
                optLunar: document.getElementById('optLunar'),
                optMale: document.getElementById('optMale'),
                optFemale: document.getElementById('optFemale')
            };
            // Populate date selects
            const today = new Date();
            for (let y = today.getFullYear() - 100; y <= today.getFullYear(); y++) {
                const option = document.createElement('option');
                option.value = y;
                option.text = y;
                if(y===1990) option.selected = true;
                ui.selYear.appendChild(option);
            }
            for (let m = 1; m <= 12; m++) {
                const option = document.createElement('option');
                option.value = m;
                option.text = m;
                ui.selMonth.appendChild(option);
            }
            ui.selMonth.addEventListener('change', updateDays);
            ui.selYear.addEventListener('change', updateDays);
            updateDays();
        }
        function updateDays() {
            ui.selDay.innerHTML = '';
            const daysInMonth = new Date(ui.selYear.value, ui.selMonth.value, 0).getDate();
            for (let d = 1; d <= daysInMonth; d++) {
                const option = document.createElement('option');
                option.value = d;
                option.text = d;
                ui.selDay.appendChild(option);
            }
        }

        // Load
        window.addEventListener('load', function() {
            lucide.createIcons();
            initUI();
            fetchSutData();
            setInterval(fetchSutData, 300000);
            if (ui.discountSlider) updateSliderVisual(10);
            adjustInputWidth();
            setupEventListeners();
        });

        // Event Listeners
        function setupEventListeners() {
            ui.krwInput.addEventListener('input', handleKrwInput);
            document.getElementById('qrButton').addEventListener('click', startQrScanner);
            document.querySelector('#scannerOverlay button').addEventListener('click', stopQrScanner);
            ui.btn20.addEventListener('click', () => setDiscount(20));
            ui.btn10.addEventListener('click', () => setDiscount(10));
            ui.discountSlider.addEventListener('input', (e) => updateDiscountFromSlider(e.target.value));
            document.querySelector('#resultCard button[aria-label="ë„ì›€ë§ ë³´ê¸°"]').addEventListener('click', toggleInfo);
            document.querySelector('#main-content button[group="chart"]').addEventListener('click', toggleChart);
            document.querySelector('#main-content button[group="fortune"]').addEventListener('click', openFortuneModal);
            ui.btnCheckFortune.addEventListener('click', calculateAndShowFortune);
            ui.btnResetFortune.addEventListener('click', resetFortune);
            document.querySelector('#fortuneModal button:last-child').addEventListener('click', closeFortuneModal);
            ui.copyBtn.addEventListener('click', copyResult);
            ui.walletBtn.addEventListener('click', handleSendTransfer);
            // Modal close buttons (using :last-child is fragile, better use onclick in html or specific IDs, but following pattern)
            document.querySelector('#scanResultModal button:last-child').addEventListener('click', closeResultModal);
            document.querySelector('#sendModal button:last-child').addEventListener('click', () => document.getElementById('sendModal').classList.add('hidden'));
            document.querySelector('#manualOpenModal button').addEventListener('click', closeManualModal);
            document.querySelector('#storeRedirectModal button:last-child').addEventListener('click', closeStoreModal);
            document.querySelector('#previousRecordModal button:last-child').addEventListener('click', closePreviousModal);
            document.getElementById('refreshText').parentElement.addEventListener('click', fetchSutData);
        }

        // --- Functions ---
        function toggleCalendar() {
            selectedCalendar = selectedCalendar === 'solar' ? 'lunar' : 'solar';
            if(selectedCalendar === 'solar') {
                ui.calSlider.style.transform = 'translateX(0)';
                ui.optSolar.className = 'toggle-option active';
                ui.optLunar.className = 'toggle-option inactive';
            } else {
                ui.calSlider.style.transform = 'translateX(100%)';
                ui.optSolar.className = 'toggle-option inactive';
                ui.optLunar.className = 'toggle-option active';
            }
        }
        function toggleGender() {
            selectedGender = selectedGender === 'male' ? 'female' : 'male';
            if(selectedGender === 'male') {
                ui.genSlider.style.transform = 'translateX(0)';
                ui.optMale.className = 'toggle-option active';
                ui.optFemale.className = 'toggle-option inactive';
            } else {
                ui.genSlider.style.transform = 'translateX(100%)';
                ui.optMale.className = 'toggle-option inactive';
                ui.optFemale.className = 'toggle-option active';
            }
        }

        function calculateAndShowFortune() {
            const y = parseInt(ui.selYear.value);
            const m = parseInt(ui.selMonth.value);
            const d = parseInt(ui.selDay.value);
            const birthDate = new Date(y, m-1, d);
            const today = new Date();
            
            const result = FortuneEngine.calculate(birthDate, today);
            const dayOfWeek = today.getDay();
            
            const textLove = FortuneEngine.getText('love', result.love, result.relation, dayOfWeek);
            const textMoney = FortuneEngine.getText('money', result.money, result.relation, dayOfWeek);
            const textWork = FortuneEngine.getText('work', result.work, result.relation, dayOfWeek);
            const textStudy = FortuneEngine.getText('work', result.study, result.relation, dayOfWeek);
            const textHealth = FortuneEngine.getText('health', result.health, result.relation, dayOfWeek);

            // Determine Theme
            const avg = (result.love + result.money + result.work + result.health) / 4;
            let theme = {};
            let mainT, mainD, emoji;

            if(avg >= 9) {
                theme = { bg: "bg-green-50", text: "text-green-600", bar: "bg-green-500" };
                mainT = "ì™„ë²½ì— ê°€ê¹Œìš´ í•˜ë£¨ì˜ˆìš”";
                mainD = "ëª¨ë“  ê¸°ìš´ì´ ë‹¹ì‹ ì„ ë•ê³  ìˆì–´ìš”. ìì‹  ìˆê²Œ ë„ì „í•´ë³´ì„¸ìš”!";
                emoji = "ğŸ€";
            } else if(avg >= 7) {
                theme = { bg: "bg-blue-50", text: "text-blue-600", bar: "bg-blue-500" };
                mainT = "ê½¤ ê´œì°®ì€ í•˜ë£¨ê°€ ë  ê±°ì˜ˆìš”";
                mainD = "ê¸ì •ì ì¸ íë¦„ì´ ì´ì–´ì§€ê³  ìˆì–´ìš”. ê¸°ë¶„ ì¢‹ì€ ì¼ë“¤ì´ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.";
                emoji = "âœ¨";
            } else if(avg >= 5) {
                theme = { bg: "bg-yellow-50", text: "text-yellow-600", bar: "bg-yellow-400" };
                mainT = "í‰ì˜¨í•˜ê³  ë¬´ë‚œí•œ í•˜ë£¨ì˜ˆìš”";
                mainD = "í° êµ´ê³¡ ì—†ì´ ì”ì”í•œ í•˜ë£¨ì…ë‹ˆë‹¤. ì—¬ìœ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.";
                emoji = "ğŸ™‚";
            } else {
                theme = { bg: "bg-orange-50", text: "text-orange-600", bar: "bg-orange-500" };
                mainT = "ì¡°ê¸ˆì€ ì‰¬ì–´ê°€ë„ ì¢‹ì•„ìš”";
                mainD = `ì˜¤ëŠ˜ì€ ì—ë„ˆì§€ë¥¼ ì•„ë¼ëŠ” ê²Œ ì¢‹ê² ì–´ìš”. (${result.dayElement}ì˜ ê¸°ìš´ê³¼ ì¶©ëŒ).`;
                emoji = "â˜•";
            }

            // Update UI
            const bgEl = document.getElementById('fortuneThemeBg');
            bgEl.className = `p-6 rounded-[24px] shadow-sm relative overflow-hidden transition-colors duration-500 mb-6 text-center ${theme.bg}`;
            document.getElementById('fortuneMainEmoji').innerText = emoji;
            document.getElementById('fortuneMainTitle').innerText = mainT;
            document.getElementById('fortuneMainDesc').innerText = mainD;

            const setBar = (id, score, text) => {
                const safeScore = Math.min(10, Math.max(1, score));
                const textEl = document.getElementById(id);
                const barEl = document.getElementById(id.replace('score','bar'));
                
                textEl.innerText = safeScore + "ì ";
                textEl.className = `text-sm font-bold ${theme.text}`;
                
                barEl.style.width = "0%";
                barEl.className = `h-full rounded-full transition-all duration-1000 ease-out ${theme.bar}`;
                setTimeout(() => { barEl.style.width = (safeScore * 10) + "%"; }, 100);
                
                document.getElementById(id.replace('score','desc')).innerText = text;
            };

            setBar('scoreLove', result.love, textLove);
            setBar('scoreMoney', result.money, textMoney);
            setBar('scoreWork', result.work, textWork);
            setBar('scoreStudy', result.study, textStudy);
            setBar('scoreHealth', result.health, textHealth);

            ui.fortuneInputStep.classList.add('hidden');
            ui.fortuneResultStep.classList.remove('hidden');
            ui.btnCheckFortune.classList.add('hidden');
            ui.btnResetFortune.classList.remove('hidden');
        }

        function resetFortune() {
            ui.fortuneInputStep.classList.remove('hidden');
            ui.fortuneResultStep.classList.add('hidden');
            ui.btnCheckFortune.classList.remove('hidden');
            ui.btnResetFortune.classList.add('hidden');
        }
        function openFortuneModal() {
            document.getElementById('fortuneModal').classList.remove('hidden');
            document.getElementById('fortuneModal').classList.add('flex');
        }
        function closeFortuneModal() {
            document.getElementById('fortuneModal').classList.remove('flex');
            document.getElementById('fortuneModal').classList.add('hidden');
        }

        function manageDailyReset() {
            const dateKey = 'aiCommentDate';
            const today = new Date().toDateString();
            if (localStorage.getItem(dateKey) !== today) {
                localStorage.setItem('aiCommentHistory', '[]');
                localStorage.setItem(dateKey, today);
            }
        }
        function handleKrwInput(e) {
            let val = e.target.value.replace(/[^0-9]/g, '');
            if (val.length > 1 && val.startsWith('0')) val = val.substring(1);
            inputAmount = val;
            e.target.value = val ? Number(val).toLocaleString() : '';
            updateScreenState();
            adjustInputWidth();
        }
        function setDiscount(rate) { discountRate = rate; updateDiscountUI(rate); calculate(); }
        function updateDiscountFromSlider(val) { discountRate = parseInt(val); updateDiscountUI(discountRate, true); calculate(); }
        function updateDiscountUI(rate, isSlider = false) {
            ui.discountDisplay.innerText = `${rate}%`;
            if (!isSlider) ui.discountSlider.value = rate;
            const active = "discount-btn active w-full py-2.5 text-xs font-bold rounded-lg shadow-sm";
            const inactive = "discount-btn inactive w-full py-2.5 text-xs font-bold rounded-lg shadow-sm";
            if (rate === 10) { ui.btn10.className = active; ui.btn20.className = inactive; }
            else if (rate === 20) { ui.btn10.className = inactive; ui.btn20.className = active; }
            else { ui.btn10.className = inactive; ui.btn20.className = inactive; }
            updateSliderVisual(rate);
        }
        function updateSliderVisual(val) {
            const percentage = (val / 50) * 100;
            ui.discountSlider.style.backgroundSize = `${percentage}% 100%`;
        }
        function updateScreenState() {
            if (!inputAmount || inputAmount === '0') {
                ui.krwKorean.innerText = '';
                ui.resultCard.classList.add('opacity-50', 'scale-95');
                ui.resultCard.classList.remove('opacity-100', 'scale-100', 'bg-purple-50');
                ui.resultCard.classList.add('bg-[#f2f4f6]');
                disableButton(ui.copyBtn);
                disableButton(ui.walletBtn);
                ui.sutAmountDisplay.innerText = '0';
            } else {
                const numVal = Number(inputAmount);
                ui.krwKorean.innerText = convertToKoreanNumber(numVal);
                ui.resultCard.classList.remove('opacity-50', 'scale-95', 'bg-[#f2f4f6]');
                ui.resultCard.classList.add('opacity-100', 'scale-100', 'bg-purple-50');
                enableButton(ui.copyBtn, 'bg-gray-200', 'text-gray-800');
                enableButton(ui.walletBtn, 'bg-purple-600', 'text-white');
                calculate();
            }
        }
        function convertToKoreanNumber(num) {
            if (num < 10000) return '';
            const units = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
            let result = '';
            let temp = num;
            for (let i = 0; i < units.length; i++) {
                let chunk = temp % 10000;
                temp = Math.floor(temp / 10000);
                if (chunk > 0) {
                    let unitPart = chunk.toLocaleString();
                    if (i > 0) unitPart += units[i];
                    result = unitPart + (result ? ' ' + result : '');
                }
            }
            return result + 'ì›';
        }
        async function fetchSutData(retryCount = 0) {
            ui.refreshIcon.classList.add('animate-spin');
            updateStatusUI('loading', "ë°ì´í„° í™•ì¸ ì¤‘...");
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            try {
                const cgPriceUrl = 'https://api.coingecko.com/api/v3/simple/token_price/polygon-pos?contract_addresses=0x98965474ecbec2f532f1f780ee37b0b05f77ca55&vs_currencies=krw&include_24hr_change=true';
                const cgChartUrl = 'https://api.coingecko.com/api/v3/coins/super-trust/market_chart?vs_currency=krw&days=1';
                const dexUrl = 'https://api.dexscreener.com/latest/dex/tokens/0x98965474ecbec2f532f1f780ee37b0b05f77ca55';
                const [cgPriceRes, cgChartRes, dexRes] = await Promise.all([
                    fetch(cgPriceUrl, { signal: controller.signal }).catch(() => ({ ok: false })),
                    fetch(cgChartUrl, { signal: controller.signal }).catch(() => ({ ok: false })),
                    fetch(dexUrl, { signal: controller.signal }).catch(() => ({ ok: false }))
                ]);
                clearTimeout(timeoutId);
                let cgPriceData = cgPriceRes.ok ? await cgPriceRes.json() : null;
                let cgChartData = cgChartRes.ok ? await cgChartRes.json() : null;
                let dexData = dexRes.ok ? await dexRes.json() : null;
                let cgScore = calculateQualityScore('coingecko', cgChartData);
                let dexScore = calculateQualityScore('dexscreener', dexData);
                let finalPrice = 0, finalChange = 0, finalChartData = [];
                let grade = 'D';
                if (cgScore > 0 && cgScore >= dexScore) {
                    const info = cgPriceData['0x98965474ecbec2f532f1f780ee37b0b05f77ca55'];
                    finalPrice = info.krw;
                    finalChange = info.krw_24h_change;
                    finalChartData = cgChartData.prices.map(item => ({ time: Math.floor(item[0]/1000), value: item[1] }));
                    grade = 'A';
                } else if (dexScore > 0) {
                    const pair = dexData.pairs[0];
                    const usdPrice = parseFloat(pair.priceUsd);
                    finalPrice = usdPrice * 1450;
                    finalChange = pair.priceChange.h24;
                    grade = 'C';
                    finalChartData = [];
                } else {
                    throw new Error("All sources failed");
                }
                if (finalChartData.length > 0) {
                    const lastTime = finalChartData[finalChartData.length-1].time;
                    const now = Math.floor(Date.now()/1000);
                    if (now - lastTime < 60) finalChartData[finalChartData.length-1].value = finalPrice;
                    else finalChartData.push({time: now, value: finalPrice});
                }
                currentSutPrice = finalPrice;
                priceGrade = grade;
                isPriceLoaded = true;
                updatePriceInfoUI(grade, finalPrice);
                updateLastTime();
                if (finalChartData.length > 0) {
                    let minVal = finalChartData[0].value, maxVal = finalChartData[0].value;
                    let minTime = finalChartData[0].time, maxTime = finalChartData[0].time;
                    finalChartData.forEach(item => {
                        if (item.value < minVal) { minVal = item.value; minTime = item.time; }
                        if (item.value > maxVal) { maxVal = item.value; maxTime = item.time; }
                    });
                    const markers = [
                        { time: minTime, position: 'belowBar', color: '#3b82f6', shape: 'circle', size: 0.4 },
                        { time: maxTime, position: 'aboveBar', color: '#ef4444', shape: 'circle', size: 0.4 }
                    ];
                    markers.sort((a, b) => a.time - b.time);
                    renderTradingViewChart(finalChartData, markers);
                } else {
                    ui.chartLoader.classList.add('hidden');
                    ui.chartError.classList.remove('hidden');
                    ui.chartError.innerText = "ì‹¤ì‹œê°„ ì°¨íŠ¸ ë°ì´í„° ë¯¸ì§€ì› (ê°€ê²©ì€ ì •ìƒì…ë‹ˆë‹¤)";
                }
            } catch (error) {
                if (retryCount < 2) {
                    setTimeout(() => fetchSutData(retryCount + 1), 2000);
                } else {
                    handleFetchError();
                }
            } finally {
                ui.refreshIcon.classList.remove('animate-spin');
            }
        }
        function calculateQualityScore(source, data) {
            let score = 0;
            const now = Date.now();
            if (!data) return -1;
            if (source === 'coingecko') {
                if (data.prices && data.prices.length > 0) score += 50;
                const lastTime = data.prices[data.prices.length - 1][0];
                if (now - lastTime < 3600000) score += 30;
            } else if (source === 'dexscreener') {
                if (data.pairs && data.pairs.length > 0) score += 40;
            }
            return score;
        }
        function updateStatusUI(state, msg) {
            if (state === 'loading') {
                ui.statusIndicator.className = "w-2 h-2 bg-yellow-400 rounded-full animate-pulse";
                ui.lastUpdatedTime.innerText = msg;
            } else if (state === 'error') {
                ui.statusIndicator.className = "w-2 h-2 bg-red-500 rounded-full";
            }
        }
        function updatePriceInfoUI(grade, price) {
            let displayPrice = "";
            let indicatorClass = "w-2 h-2 rounded-full ";
            if (grade === 'A') {
                displayPrice = `1 SUT = ${price.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} KRW`;
                indicatorClass += "bg-green-500 animate-pulse";
            } else if (grade === 'B') {
                displayPrice = `ì•½ 1 SUT = ì•½ ${Math.round(price).toLocaleString()} KRW`;
                indicatorClass += "bg-yellow-500";
            } else if (grade === 'C') {
                displayPrice = `ìµœê·¼ ê±°ë˜ ê¸°ì¤€ (ì•½ ${Math.round(price)}ì›)`;
                indicatorClass += "bg-orange-500";
            }
            ui.priceDisplay.innerText = displayPrice;
            ui.statusIndicator.className = indicatorClass;
            if (inputAmount) calculate();
        }
        function handleFetchError() {
            updateStatusUI('error', 'ì—°ê²° ì‹¤íŒ¨');
            ui.priceDisplay.innerText = "ê°€ê²© ë™ê¸°í™” ì¤‘";
            ui.chartLoader.classList.add('hidden');
            ui.chartError.classList.remove('hidden');
        }
        function updateLastTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit' });
            ui.lastUpdatedTime.innerText = `ì—…ë°ì´íŠ¸ë¨ (${timeStr})`;
        }
        function renderTradingViewChart(data, markers) {
            const container = document.getElementById('tvChartContainer');
            if (!container || !window.LightweightCharts) return;
            ui.chartLoader.classList.add('hidden');
            ui.chartError.classList.add('hidden');
            if (!chartInstance) {
                chartInstance = window.LightweightCharts.createChart(container, {
                    layout: { background: { type: 'solid', color: 'transparent' }, textColor: '#9ca3af' },
                    grid: { vertLines: { visible: false }, horzLines: { visible: false } },
                    rightPriceScale: { borderVisible: false },
                    timeScale: {
                        borderVisible: false,
                        timeVisible: true,
                        secondsVisible: false,
                        tickMarkFormatter: (time) => new Date(time * 1000).toLocaleTimeString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', minute: '2-digit', hour12: false }),
                    },
                    crosshair: { vertLine: { labelBackgroundColor: '#9333ea' }, horzLine: { labelBackgroundColor: '#9333ea' } },
                    handleScroll: false,
                    handleScale: false,
                    localization: {
                        timeFormatter: (time) => {
                            const date = new Date(time * 1000);
                            const formatter = new Intl.DateTimeFormat('ko-KR', { timeZone: 'Asia/Seoul', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
                            const parts = formatter.formatToParts(date);
                            const m = parts.find(p => p.type === 'month').value;
                            const d = parts.find(p => p.type === 'day').value;
                            const h = parts.find(p => p.type === 'hour').value;
                            const min = parts.find(p => p.type === 'minute').value;
                            return `${m}ì›” ${d}ì¼ ${h}:${min}`;
                        }
                    }
                });
                pastSeries = chartInstance.addAreaSeries({ topColor: 'rgba(156, 163, 175, 0.4)', bottomColor: 'rgba(156, 163, 175, 0.0)', lineColor: '#9ca3af', lineWidth: 2, crosshairMarkerVisible: false });
                todaySeries = chartInstance.addAreaSeries({ topColor: 'rgba(147, 51, 234, 0.2)', bottomColor: 'rgba(147, 51, 234, 0.0)', lineColor: '#9333ea', lineWidth: 2 });
                new ResizeObserver(entries => {
                    if (entries.length) {
                        const r = entries[0].contentRect;
                        chartInstance.applyOptions({ width: r.width, height: r.height });
                    }
                }).observe(container);
            }
            const now = new Date();
            const kstOptions = { timeZone: 'Asia/Seoul', year: 'numeric', month: '2-digit', day: '2-digit' };
            const todayStr = new Intl.DateTimeFormat('ko-KR', kstOptions).format(now);
            const pastData = [], todayData = [];
            data.forEach(d => {
                const date = new Date(d.time * 1000);
                if (new Intl.DateTimeFormat('ko-KR', kstOptions).format(date) === todayStr) todayData.push(d);
                else pastData.push(d);
            });
            if (pastData.length > 0 && todayData.length > 0) todayData.unshift(pastData[pastData.length - 1]);
            pastSeries.setData(pastData);
            todaySeries.setData(todayData);
            const todayMarkers = markers.filter(m => new Intl.DateTimeFormat('ko-KR', kstOptions).format(new Date(m.time * 1000)) === todayStr);
            todaySeries.setMarkers(todayMarkers);
            chartInstance.timeScale().fitContent();
        }
        function toggleInfo() { document.getElementById('infoText').classList.toggle('hidden'); }
        function disableButton(b) { if(!b)return; b.disabled=true; b.className = "flex-1 bg-[#e5e8eb] text-[#b0b8c1] font-bold text-base py-2.5 rounded-xl transition-all flex items-center justify-center gap-2"; }
        function enableButton(b, bg, tc) { if(!b)return; b.disabled=false; b.className = `flex-1 ${bg} ${tc} font-bold text-base py-2.5 rounded-xl active:scale-[0.98] transition-all flex items-center justify-center gap-2 shadow-sm`; }
        function calculate() { if(!inputAmount||currentSutPrice===0||priceGrade==='D'){ui.sutAmountDisplay.innerText='0'; return;} const krw=parseInt(inputAmount); const dKrw=krw*((100-discountRate)/100); const sut=Math.ceil((dKrw / currentSutPrice) * 1000) / 1000; ui.sutAmountDisplay.innerText = sut.toLocaleString(undefined, { minimumFractionDigits: 3, maximumFractionDigits: 3 }); }
        function copyResult() { const t=ui.sutAmountDisplay.innerText.replace(/,/g,''); navigator.clipboard.writeText(t).then(()=>showToast(`${t} SUT ë³µì‚¬ë˜ì—ˆì–´ìš”`)); }
        function handleSendTransfer() { const t=ui.sutAmountDisplay.innerText.replace(/,/g,''); const amount = parseFloat(t); if (!amount || amount <= 0) return alert("ê²°ì œí•  ê¸ˆì•¡ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”."); navigator.clipboard.writeText(t); ui.sendModalSut.innerText = `${t} SUT`; ui.sendModalKrw.innerText = `${ui.krwInput.value}ì›`; document.getElementById('sendModal').classList.remove('hidden'); document.getElementById('sendModal').classList.add('flex'); directOpenWallet(); }
        function directOpenWallet() {
            window.location.href = "trust://open";
            setTimeout(() => {
                if (!document.hidden) window.location.href = "https://link.trustwallet.com/open";
            }, 1000);
        }
        function copyAndOpenWallet() { navigator.clipboard.writeText(scannedAddress).then(()=>{showToast("ì£¼ì†Œ ë³µì‚¬ë¨. ì§€ê°‘ ì—´ê¸°..."); directOpenWallet();}); }
        function closeResultModal() { document.getElementById('scanResultModal').classList.add('hidden'); }
        function closeManualModal() { document.getElementById('manualOpenModal').classList.add('hidden'); }
        function closeStoreModal() { document.getElementById('storeRedirectModal').classList.add('hidden'); }
        function showToast(m) { const t=document.getElementById('toast'); t.innerText=m; t.style.opacity='1'; t.style.transform='translate(-50%,0)'; setTimeout(()=>{t.style.opacity='0';t.style.transform='translate(-50%,-10px)'},2000); }
        function startQrScanner() { isProcessingScan=false; const scannerOverlay = document.getElementById('scannerOverlay'); const qrButton = document.getElementById('qrButton'); const rect = qrButton.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; scannerOverlay.style.setProperty('--origin-x', `${centerX}px`); scannerOverlay.style.setProperty('--origin-y', `${centerY}px`); scannerOverlay.classList.remove('hidden'); scannerOverlay.classList.remove('hide'); scannerOverlay.classList.add('flex'); void scannerOverlay.offsetWidth; requestAnimationFrame(() => scannerOverlay.classList.add('show')); setTimeout(() => { if (html5QrCode) html5QrCode.clear().catch(console.error); html5QrCode = new Html5Qrcode("qr-reader"); const config = { fps: 20, qrbox: { width: 260, height: 260 }, aspectRatio: 1.0, disableFlip: false }; html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess).catch(err => alert("ì¹´ë©”ë¼ ê¶Œí•œ í•„ìš”: " + err)); }, 300); }
        function stopQrScanner() { const scannerOverlay = document.getElementById('scannerOverlay'); const qrButton = document.getElementById('qrButton'); const rect = qrButton.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; scannerOverlay.style.setProperty('--origin-x', `${centerX}px`); scannerOverlay.style.setProperty('--origin-y', `${centerY}px`); scannerOverlay.classList.remove('show'); scannerOverlay.classList.add('hide'); setTimeout(() => { scannerOverlay.classList.add('hidden'); scannerOverlay.classList.remove('flex', 'hide'); scannerOverlay.style.removeProperty('--origin-x'); scannerOverlay.style.removeProperty('--origin-y'); }, 500); if (html5QrCode) html5QrCode.stop().catch(console.error); }
        function onScanSuccess(d) { if (isProcessingScan) return; isProcessingScan = true; ui.scanFrame.classList.add('scan-success'); setTimeout(() => { scannedAddress = d; stopQrScanner(); ui.scanModalAddress.innerText = scannedAddress; const amount = ui.sutAmountDisplay.innerText.replace(/,/g, ''); const krw = ui.krwInput.value || '0'; if (amount !== '0') { ui.scanAmountDetails.classList.remove('hidden'); ui.scanModalSut.innerText = amount + ' SUT'; ui.scanModalKrw.innerText = krw + 'ì›'; } else { ui.scanAmountDetails.classList.add('hidden'); } document.getElementById('scanResultModal').classList.remove('hidden'); document.getElementById('scanResultModal').classList.add('flex'); isProcessingScan = false; ui.scanFrame.classList.remove('scan-success'); }, 500); }
        function toggleChart() { const c=document.getElementById('chartContent'); const i=document.getElementById('chartToggleIcon'); c.classList.toggle('hidden'); i.classList.toggle('rotate-180'); if(!c.classList.contains('hidden') && chartInstance){const r=document.getElementById('tvChartContainer').getBoundingClientRect(); chartInstance.applyOptions({width:r.width,height:r.height}); chartInstance.timeScale().fitContent();} }
        function adjustInputWidth() { const val = ui.krwInput.value || ui.krwInput.placeholder; const span = document.createElement('span'); span.style.font = window.getComputedStyle(ui.krwInput).font; span.style.fontWeight = window.getComputedStyle(ui.krwInput).fontWeight; span.style.fontSize = window.getComputedStyle(ui.krwInput).fontSize; span.style.letterSpacing = window.getComputedStyle(ui.krwInput).letterSpacing; span.style.visibility = 'hidden'; span.style.position = 'absolute'; span.style.whiteSpace = 'pre'; span.innerText = val; document.body.appendChild(span); const width = span.offsetWidth; ui.krwInput.style.width = (width + 2) + 'px'; document.body.removeChild(span); }
        function saveLastCalculation(sut, krw, address) { localStorage.setItem('lastSut', sut); localStorage.setItem('lastKrw', krw); localStorage.setItem('lastAddress', address); }
        function checkAndDisplayPreviousRecord() {}
        function copyPrevAddress() { navigator.clipboard.writeText(document.getElementById('prevModalAddress').innerText).then(()=>showToast('ì£¼ì†Œ ë³µì‚¬ë¨')); }
        function closePreviousModal() { document.getElementById('previousRecordModal').classList.add('hidden'); }
        function goToStore() { window.location.href = 'https://apps.apple.com/app/trust-wallet/id1288339409'; }
        function closeStoreModal() { document.getElementById('storeRedirectModal').classList.add('hidden'); }
    </script>
</body>
</html>
